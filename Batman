import React, { useState } from 'react';
import { AlertTriangle, Skull, TrendingDown, Clock } from 'lucide-react';

// Mock skill database with mortality data
const SKILL_DATABASE = {
  'jquery': { risk: 92, halfLife: 1.2, status: 'Dead', mutation: 'React or Vue.js' },
  'flash': { risk: 100, halfLife: 0, status: 'Dead', mutation: 'WebGL or Three.js' },
  'php': { risk: 68, halfLife: 3.8, status: 'Decaying', mutation: 'Node.js + TypeScript' },
  'wordpress': { risk: 71, halfLife: 3.2, status: 'Decaying', mutation: 'Headless CMS + React' },
  'angular': { risk: 54, halfLife: 5.5, status: 'Saturated', mutation: 'React + Next.js' },
  'vue': { risk: 42, halfLife: 6.8, status: 'Saturated', mutation: 'React or Svelte' },
  'react': { risk: 28, halfLife: 8.5, status: 'Saturated', mutation: 'React + AI/ML libraries' },
  'python': { risk: 22, halfLife: 9.2, status: 'Saturated', mutation: 'Python + Rust or Go' },
  'javascript': { risk: 31, halfLife: 8.1, status: 'Saturated', mutation: 'TypeScript required' },
  'typescript': { risk: 18, halfLife: 10.5, status: 'Emerging', mutation: 'TypeScript + Rust' },
  'rust': { risk: 15, halfLife: 12.3, status: 'Emerging', mutation: 'Rust + WebAssembly' },
  'go': { risk: 19, halfLife: 10.1, status: 'Emerging', mutation: 'Go + Kubernetes' },
  'svelte': { risk: 25, halfLife: 9.5, status: 'Emerging', mutation: 'Svelte + SvelteKit' },
  'nextjs': { risk: 21, halfLife: 9.8, status: 'Emerging', mutation: 'Next.js + Edge Computing' },
  'tailwind': { risk: 23, halfLife: 9.3, status: 'Emerging', mutation: 'Tailwind + Design Systems' },
  'graphql': { risk: 38, halfLife: 7.2, status: 'Saturated', mutation: 'tRPC or REST' },
  'kubernetes': { risk: 26, halfLife: 9.1, status: 'Emerging', mutation: 'K8s + Service Mesh' },
  'docker': { risk: 33, halfLife: 7.9, status: 'Saturated', mutation: 'Docker + Kubernetes' },
  'aws': { risk: 29, halfLife: 8.7, status: 'Saturated', mutation: 'Multi-cloud + IaC' },
  'tensorflow': { risk: 41, halfLife: 6.9, status: 'Saturated', mutation: 'PyTorch preferred' },
  'pytorch': { risk: 24, halfLife: 9.4, status: 'Emerging', mutation: 'PyTorch + LLM fine-tuning' },
  'mongodb': { risk: 37, halfLife: 7.4, status: 'Saturated', mutation: 'PostgreSQL + JSON' },
  'postgresql': { risk: 27, halfLife: 8.9, status: 'Saturated', mutation: 'Postgres + Vector DB' },
  'sql': { risk: 35, halfLife: 7.7, status: 'Saturated', mutation: 'SQL + Modern Data Stack' },
  'java': { risk: 58, halfLife: 4.8, status: 'Decaying', mutation: 'Kotlin or Go' },
  'c#': { risk: 52, halfLife: 5.3, status: 'Saturated', mutation: 'C# + .NET Core + Cloud' },
  'ruby': { risk: 73, halfLife: 2.9, status: 'Decaying', mutation: 'Elixir or Go' },
  'rails': { risk: 76, halfLife: 2.5, status: 'Decaying', mutation: 'Phoenix or Next.js' },
  'backbone': { risk: 95, halfLife: 0.5, status: 'Dead', mutation: 'React or Vue' },
  'ember': { risk: 88, halfLife: 1.5, status: 'Dead', mutation: 'React or Svelte' },
};

const COMMON_SKILLS = [
  'React', 'Python', 'JavaScript', 'TypeScript', 'Next.js', 'Rust', 'Go',
  'Vue', 'Angular', 'Svelte', 'PHP', 'Java', 'C#', 'Ruby', 'Rails',
  'Node.js', 'TensorFlow', 'PyTorch', 'Kubernetes', 'Docker', 'AWS',
  'PostgreSQL', 'MongoDB', 'GraphQL', 'Tailwind', 'jQuery', 'Backbone'
];

export default function SkillMortalityRadar() {
  const [screen, setScreen] = useState('landing');
  const [selectedSkills, setSelectedSkills] = useState([]);
  const [analysis, setAnalysis] = useState(null);

  const analyzeSkills = () => {
    if (selectedSkills.length === 0) return;

    const skillData = selectedSkills.map(skill => {
      const key = skill.toLowerCase().replace(/\s+/g, '').replace('.js', 'js').replace('node.js', 'nodejs');
      return SKILL_DATABASE[key] || {
        risk: Math.floor(Math.random() * 40) + 30,
        halfLife: Math.random() * 5 + 4,
        status: 'Saturated',
        mutation: 'Diversify skill stack'
      };
    });

    const avgRisk = Math.round(skillData.reduce((sum, s) => sum + s.risk, 0) / skillData.length);
    const minHalfLife = Math.min(...skillData.map(s => s.halfLife));

    setAnalysis({
      skills: selectedSkills.map((skill, i) => ({ name: skill, ...skillData[i] })),
      overallRisk: avgRisk,
      criticalHalfLife: minHalfLife,
      verdict: getVerdict(avgRisk, minHalfLife)
    });

    setScreen('result');
  };

  const getVerdict = (risk, halfLife) => {
    if (risk >= 85) return 'This skill is dead.';
    if (risk >= 65) return 'This skill is dying.';
    if (risk >= 45) return 'Market saturation detected.';
    if (risk >= 25) return 'Risk present. Mutation advised.';
    return 'Low risk. Monitor market shifts.';
  };

  const getRiskColor = (risk) => {
    if (risk >= 85) return 'text-red-500';
    if (risk >= 65) return 'text-red-400';
    if (risk >= 45) return 'text-orange-500';
    if (risk >= 25) return 'text-amber-500';
    return 'text-yellow-500';
  };

  const getStatusColor = (status) => {
    const colors = {
      'Dead': 'text-red-500',
      'Decaying': 'text-red-400',
      'Saturated': 'text-orange-500',
      'Emerging': 'text-amber-400'
    };
    return colors[status] || 'text-gray-400';
  };

  const toggleSkill = (skill) => {
    if (selectedSkills.includes(skill)) {
      setSelectedSkills(selectedSkills.filter(s => s !== skill));
    } else if (selectedSkills.length < 2) {
      setSelectedSkills([...selectedSkills, skill]);
    }
  };

  if (screen === 'landing') {
    return (
      <div className="min-h-screen bg-black text-gray-100 flex items-center justify-center p-4">
        <div className="max-w-2xl w-full">
          <div className="flex items-center gap-3 mb-8 justify-center">
            <Skull className="w-10 h-10 text-red-500" />
            <h1 className="text-4xl font-bold">Skill Mortality Radar</h1>
          </div>
          
          <p className="text-gray-400 text-center mb-8">
            Market reality check. No motivation. Just truth.
          </p>

          <div className="mb-8">
            <label className="block text-sm text-gray-500 mb-3">
              SELECT 1-2 SKILLS ({selectedSkills.length}/2)
            </label>
            <div className="grid grid-cols-2 sm:grid-cols-3 gap-2">
              {COMMON_SKILLS.map(skill => (
                <button
                  key={skill}
                  onClick={() => toggleSkill(skill)}
                  className={`px-4 py-2 text-sm border transition-colors ${
                    selectedSkills.includes(skill)
                      ? 'border-red-500 bg-red-500/10 text-red-400'
                      : 'border-gray-800 hover:border-gray-700 text-gray-400'
                  }`}
                >
                  {skill}
                </button>
              ))}
            </div>
          </div>

          <button
            onClick={analyzeSkills}
            disabled={selectedSkills.length === 0}
            className="w-full py-4 bg-red-600 hover:bg-red-700 disabled:bg-gray-800 disabled:text-gray-600 text-white font-medium transition-colors"
          >
            {selectedSkills.length === 0 ? 'SELECT SKILLS' : 'SCAN MORTALITY RISK'}
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-black text-gray-100 p-4 sm:p-8">
      <div className="max-w-3xl mx-auto">
        <button
          onClick={() => {
            setScreen('landing');
            setSelectedSkills([]);
            setAnalysis(null);
          }}
          className="text-gray-500 hover:text-gray-400 mb-8 text-sm"
        >
          ‚Üê NEW SCAN
        </button>

        {/* Verdict */}
        <div className="border border-red-900/50 bg-red-950/20 p-8 mb-8">
          <div className="flex items-center gap-3 mb-4">
            <AlertTriangle className="w-8 h-8 text-red-500" />
            <h2 className="text-3xl font-bold">VERDICT</h2>
          </div>
          <p className="text-2xl text-red-400 mb-6">{analysis.verdict}</p>
          
          <div className="grid grid-cols-2 gap-4 pt-6 border-t border-red-900/30">
            <div>
              <div className="text-sm text-gray-500 mb-1">OVERALL RISK</div>
              <div className={`text-4xl font-bold ${getRiskColor(analysis.overallRisk)}`}>
                {analysis.overallRisk}%
              </div>
            </div>
            <div>
              <div className="text-sm text-gray-500 mb-1">CRITICAL HALF-LIFE</div>
              <div className="text-4xl font-bold text-orange-500 flex items-center gap-2">
                <Clock className="w-8 h-8" />
                {analysis.criticalHalfLife.toFixed(1)}y
              </div>
            </div>
          </div>
        </div>

        {/* Skill Breakdown */}
        <div className="space-y-4 mb-8">
          <h3 className="text-xl font-bold text-gray-400 flex items-center gap-2">
            <TrendingDown className="w-5 h-5" />
            SKILL BREAKDOWN
          </h3>
          {analysis.skills.map((skill, idx) => (
            <div key={idx} className="border border-gray-900 bg-gray-950/50 p-6">
              <div className="flex justify-between items-start mb-4">
                <h4 className="text-xl font-bold">{skill.name}</h4>
                <span className={`text-sm font-medium ${getStatusColor(skill.status)}`}>
                  {skill.status.toUpperCase()}
                </span>
              </div>
              
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <div className="text-xs text-gray-600 mb-1">MORTALITY RISK</div>
                  <div className={`text-3xl font-bold ${getRiskColor(skill.risk)}`}>
                    {skill.risk}%
                  </div>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">HALF-LIFE REMAINING</div>
                  <div className="text-3xl font-bold text-orange-500">
                    {skill.halfLife.toFixed(1)} years
                  </div>
                </div>
              </div>

              {/* Mutation Path */}
              <div className="border-t border-gray-900 pt-4">
                <div className="text-xs text-gray-600 mb-2">SURVIVAL MUTATION</div>
                <div className="text-amber-400 font-medium">{skill.mutation}</div>
              </div>
            </div>
          ))}
        </div>

        <div className="text-center text-sm text-gray-600 border-t border-gray-900 pt-8 space-y-1">
          <div>
            Data synthesized from market demand signals and technology adoption curves.
          </div>
          <div className="text-gray-700 text-xs">
            Created by Abdul Gafur
          </div>
        </div>
      </div>
    </div>
  );
}
